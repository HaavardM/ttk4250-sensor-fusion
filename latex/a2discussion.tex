\subsection{Discussion}
This sections contains some thoughts on ESKF from tuning the filter for the simulated and the real dataset.



\subsubsection{Consistency}
When tuning the ESKF we want to achieve high precision, but we also want a consistent filter. In our case we expect increased model errors in the turns due to the non-linear motion, and we want the filters covariance to increase as the model gets less accurate. We superimposed the predicted covariance norm over the XY track to visualize how the filters confidence evolves during the track. As can be seen from \cref{fig:eskf-real-ppred-coloredtrack} the uncertianty increases during the turns as expected. By also superimposing the NIS over the XY track, as seen in \cref{fig:eskf-real-nis-coloredtrack}, we see that our current tuning balance the covariance and innovation well, and there are no significant increase in NIS during turns. 
We also note the large spike in NIS early in \cref{fig:eskf-real-nis-basic} (note the use of logarithm to better visualize the spike). This spike appears at $t=206s$, right as the AUV is catapulted into the air, as such it is natural to expect a large innovation value.

\subsubsection{Attitude estimation (task 3B)}
The attitude estimation for roll and pitch is very precise which makes sense since they are observable using the IMU due to the constant gravity vector. Yaw is however not possible to observe without additional requirements on the measurements. Without any sensor for measuring global heading (i.e compass) we need to get the heading from the velocity, which we can estimate from the GNSS measurements \textit{if the plane is moving.} If the velocity vector is zero, we have no information about the direction and can not estimate the heading. (i.e lack of suffecient exciation) 

\subsubsection{IMU Mounting errors (task 3C and 4B)}
We tried a few different correction matrices  in the simulated dataset to determine how the correction matrices $S_a$ and $S_g$ affect the performance of our filter. First we rotated the provided $S_a$ and $S_g$ $90^\circ$ in the roll axis and initialized the filter with the same $90^\circ$ offset. We simulated and observed that the filter worked fine with only a minor increase in error (RMSE increased only a few centimeters for position and velocity), except for the expected $90^\circ$Â offset in roll attitude compared to ground truth. We then tried to use $S_a = S_g = I$ and observed a substantial increasing in error (RMSE) for all states. RMSE doubled for XY position and almost tripled for XY velocity. It had little effect on the NIS, but the filter became over-confident and NEES was way off.

Mounting errors of the IMU will affect how we define the body frame. When using other sensors in the body frame it is important that we know how they all relate to the body frame so get accurate measurement models. If the IMU is mounted incorrectly in our case, the specified leverarm for the GNSS receiver will not be correct and it will cause loss of accuracy. We only rely on the attitude of the body frame when transforming the IMU measurement into world frame during prediction, and when updating the estimate using GNSS \textit{due to the leverarm.}. The prediction step would be almost completely unaffected by mounting errors of the IMU as long as the filter is given enough time to converge. As long as the IMU knowns its own orientation it is able to transform the measurements into world frame. The GNSS receiver also depends on the attitude due to the leverarm of the antenna, which is specified in the AUV body frame. The relatively large uncertianty for GNSS does however reduce the impact small mounting errors of the IMU might have. This is why there was no significant increase in error when introducing large mounting errors. The error would however be larger if more precise GNSS (RTK) or other body frame dependent measurements are used. From this we conclude that the IMU should be mounted correctly (or compenstate for any errors in software), but small errors will not completely break the filter other than an attitude offset in body frame. 

Misalignment of the coordinate axes of the IMU from manufacturing is however a bit worse since we then have correlation between the different axis. Acceleration in one axis will "contaminate" the measurements for the misaligned axes and therefore violate the assumption that the IMU sensor noise is white (we no longer get zero mean due to the added contamination from the misaligned axis). It is therefore important to correct for misalignment errors to get as precise nominal prediction as possible. This is why the error increased a lot more when using $S_a = S_g = I$.

We tried the experiment on both the simulated and the real dataset to confirm our reasoning. On the real dataset we do however not have any ground truth to use for error metrics. It is therefore difficult to quantify errors when using another correction matrix. In reality it is diffcult to know if the AUV is affected by small mounting or misalignment errors without somehow aquiring a precise ground truth. Even with ground truth it is difficult to tell if filter errors is caused by wrong correction matrices, by non-optimal tuning or both. 
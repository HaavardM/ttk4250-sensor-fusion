\subsection{Tuning of ESKF for simulated data}

We initialized the tuning by looking up typical values for GNASS and IMUs. For the IMU and gyroscope input models we used the datasheet for STIM300 to find the discrete time noise parameters which we then converted to discrete time using equation 10.70 in the book. The values from the datasheet had to be scaled using $h=3600s$ to get correct units. We tuned the standard deviation for GNASS using \texttt{eskf.NISGNSS} and attempted to get it within the $95\%$ CI. We increased the standard deviation for the altitude component in the GNSS measurement noise since GNSS is usually best at estimating XY position. For the bias models we selected a reciprocal time constant $p_{ab} = p_{\omega b} = 10^{-3}$ after some trial and error. The bias noises were then hand tuned to get NEES for bias within the $95\%$ CI. We also looked at the estimation errors and made sure they remained reasonably low. We had extra focus on the attitude error because it propogates into the acceleration in the intertial frame (which causes a lot of errors when integrated twice for position). The error state covariance was initialized to a quite low value to a long period of large errors in the beginning until the filter has converged. Initialization is important for ESKF as it can  converge very slow if initialized incorrectly. 


\begin{figure}
    \centering
    \begin{adjustbox}{minipage=1.1\linewidth, scale=1}
        \begin{subfigure}{.5\textwidth}
            \includegraphics[width=\linewidth]{plots/a2-sim-state_error.pdf} 
            \caption{State error}
            \label{fig:a2-sim-state_error}
        \end{subfigure}
        \begin{subfigure}{.5\textwidth}
            \includegraphics[width=\linewidth]{plots/a2-sim-nees.pdf} 
            \caption{NEES}
            \label{fig:a2-sim-nees}
        \end{subfigure}
    \end{adjustbox}
        \caption{ESKF filter error for simulated data}
        \label{fig:a2-sim-error_NEES}
\end{figure}
\begin{figure}
    \centering
    \includegraphics[width=0.7\linewidth]{plots/a2-sim-estimates.pdf} 
    \caption{State estimates}
    \label{fig:a2-sim-estimates}
\end{figure}

\input{a2task2paramvalues} 
